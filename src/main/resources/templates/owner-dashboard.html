<!DOCTYPE html>
<html lang="el" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Î™Î´Î¹Î¿ÎºÏ„Î®Ï„Î·</title>
    <link rel="stylesheet" href="/css/styles.css">
    <style>
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; vertical-align: top; }
        th { background-color: #f2f2f2; }
        .btn-accept { background-color: #28a745; color: white; border: none; padding: 5px 10px; cursor: pointer; border-radius: 4px; }
        .btn-reject { background-color: #dc3545; color: white; border: none; padding: 5px 10px; cursor: pointer; border-radius: 4px; }
        .status-new { font-weight: bold; color: blue; }
        .btn-prep { background-color: #ffc107; border: none; padding: 5px 10px; cursor: pointer; border-radius: 4px; }
        .btn-complete { background-color: #17a2b8; color: white; border: none; padding: 5px 10px; cursor: pointer; border-radius: 4px; }
        .address-box { font-size: 0.85em; color: #333; margin-top: 5px; background: #f9f9f9; padding: 5px; border-radius: 4px; border: 1px dashed #ccc; }
    </style>
</head>
<body>
<header>
    <h1>Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Î Î±ÏÎ±Î³Î³ÎµÎ»Î¹ÏÎ½</h1>
    <nav>
        <a th:href="@{/}">Î‘ÏÏ‡Î¹ÎºÎ®</a> |
        <a th:href="@{/profile}">Î ÏÎ¿Ï†Î¯Î»</a> |
        <form th:action="@{/logout}" method="post" style="display:inline;">
            <button type="submit" style="background:none; border:none; color:inherit; cursor:pointer; font-size:1em; padding:0; text-decoration:underline;">Î‘Ï€Î¿ÏƒÏÎ½Î´ÎµÏƒÎ·</button>
        </form>
    </nav>
</header>

<main>
    <h2>Î•Î¹ÏƒÎµÏÏ‡ÏŒÎ¼ÎµÎ½ÎµÏ‚ Î Î±ÏÎ±Î³Î³ÎµÎ»Î¯ÎµÏ‚</h2>

    <div th:if="${orders.isEmpty()}">
        <p>Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Ï€Î±ÏÎ±Î³Î³ÎµÎ»Î¯ÎµÏ‚ Î³Î¹Î± Ï„Î± ÎºÎ±Ï„Î±ÏƒÏ„Î®Î¼Î±Ï„Î¬ ÏƒÎ±Ï‚.</p>
    </div>

    <table th:unless="${orders.isEmpty()}">
        <thead>
        <tr>
            <th>ID</th>
            <th>ÎšÎ±Ï„Î¬ÏƒÏ„Î·Î¼Î±</th>
            <th>Î ÎµÎ»Î¬Ï„Î·Ï‚</th>
            <th>Î¤ÏÏ€Î¿Ï‚ / Î”Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·</th>
            <th>Î Î¿ÏƒÏŒ</th>
            <th>Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±</th>
            <th>ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·</th>
            <th>Î•Î½Î­ÏÎ³ÎµÎ¹ÎµÏ‚</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="order : ${orders}">
            <td th:text="'#' + ${order.id}"></td>
            <td th:text="${order.store.name}"></td>
            <td th:text="${order.user.username}"></td>

            <td>
                <strong th:text="${order.orderType}"></strong>

                <div th:if="${#strings.toString(order.orderType) == 'DELIVERY' and order.deliveryAddress != null}" class="address-box">
                    ğŸ“ <span th:text="${order.deliveryAddress.street}"></span>,
                    <span th:text="${order.deliveryAddress.city}"></span>
                    <br>
                    TK: <span th:text="${order.deliveryAddress.zip}"></span>

                    <div th:if="${order.deliveryAddress.notes != null and !order.deliveryAddress.notes.isEmpty()}">
                        <em th:text="'(' + ${order.deliveryAddress.notes} + ')'"></em>
                    </div>
                </div>
            </td>

            <td th:text="${order.totalAmount} + 'â‚¬'"></td>
            <td th:text="${#temporals.format(order.createdDate, 'dd-MM-yyyy HH:mm')}"></td>
            <td>
                    <span th:text="${order.status.greekName}"
                          th:classappend="${order.status.name() == 'NEW'} ? 'status-new'"></span>
            </td>
            <td>
                <div th:if="${order.status.name() == 'NEW'}" style="display:flex; gap:5px;">
                    <form th:action="@{/owner/orders/{id}/status(id=${order.id})}" method="post">
                        <input type="hidden" name="status" value="ACCEPTED">
                        <button type="submit" class="btn-accept">Î‘Ï€Î¿Î´Î¿Ï‡Î®</button>
                    </form>
                    <form th:action="@{/owner/orders/{id}/status(id=${order.id})}" method="post">
                        <input type="hidden" name="status" value="REJECTED">
                        <button type="submit" class="btn-reject">Î‘Ï€ÏŒÏÏÎ¹ÏˆÎ·</button>
                    </form>
                </div>

                <div th:if="${order.status.name() == 'ACCEPTED'}">
                    <form th:action="@{/owner/orders/{id}/status(id=${order.id})}" method="post">
                        <input type="hidden" name="status" value="PREPARING">
                        <button type="submit" class="btn-prep">ÎÎµÎºÎ¯Î½Î± Î ÏÎ¿ÎµÏ„Î¿Î¹Î¼Î±ÏƒÎ¯Î±</button>
                    </form>
                </div>

                <div th:if="${order.status.name() == 'PREPARING'}">
                    <form th:action="@{/owner/orders/{id}/status(id=${order.id})}" method="post">
                        <input type="hidden" name="status" value="COMPLETED">
                        <button type="submit" class="btn-complete">ÎŸÎ»Î¿ÎºÎ»Î®ÏÏ‰ÏƒÎ·</button>
                    </form>
                </div>

                <span th:if="${order.status.name() == 'COMPLETED' or order.status.name() == 'REJECTED'}" style="color:gray;">
                        ÎŸÎ»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ
                    </span>
            </td>
        </tr>
        </tbody>
    </table>
</main>
</body>
</html>